# 好利来网站开发任务清单

## 已完成
- [x] 基础网站框架搭建
- [x] 首页设计和实现
- [x] 产品展示页面
- [x] 新闻动态页面
- [x] 技术支持页面
- [x] 联系我们页面
- [x] 管理后台基础功能
- [x] 用户认证系统
- [x] 联系页面优化:移除地图集成说明
- [x] 联系页面优化:移除空地址行
- [x] 联系页面优化:移除电话Skype链接

## 进行中
- [ ] 建立产品父分类和子分类体系
- [ ] 导入爬取的产品数据
- [ ] 导入爬取的技术文档数据

## 待处理
- [ ] 修复管理后台登录问题(cookie/session)
- [ ] 测试管理面板功能
- [ ] 测试文档上传功能
- [ ] 优化产品展示页面的分类筛选
- [ ] 添加产品搜索功能

## 已知问题
- [ ] 管理后台登录循环问题(admin用户role已修复为admin,需服务器端验证)



## 最新更新 (2025-10-28)
- [x] 建立产品父分类和子分类体系 (已完成,共126个分类)
  - 19个一级分类: 水泵、通风系统、锚机、舵机、电池开关、雨刮器、喇叭、液位计、尾轴密封、碰球、锌块、磁罗经、马桶、灭火器、岸电插头插座、污水处理装置、冰箱、充电器、逆变器
  - 多个二级分类(品牌)和三级分类(具体产品类型)


## 待处理 (2025-10-28)
- [x] 修改首页产品类别展示:只显示前8个一级分类(2行x4列)
- [x] 首页产品类别点击跳转到产品页面(已有链接到/shop)
- [x] 修复登录cookie问题(添加credentials: "include")



## 待处理 (2025-10-29)
- [x] 修复后台新闻上传功能(404问题)
- [x] 修复后台产品上传功能(404问题)
- [x] 创建新闻管理页面(列表、创建、编辑)
- [x] 创建产品管理页面(列表、创建、编辑)



## 待处理 (2025-10-29 下午)
- [x] 新闻管理:封面图片改为文件上传功能
- [x] 新闻管理:集成富文本编辑器(支持插入图片、字体、字号、颜色)
- [x] 产品管理:产品图片改为文件上传功能
- [x] 产品管理:添加资料下载功能(支持上传PDF等文件)
- [x] 产品详情页:添加"产品参数"和"资料下载"两个选项卡
- [x] 后台:实现文件上传到S3存储的通用组件
- [x] 数据库:产品表添加downloads字段存储资料文件



## Bug修复 (2025-10-29)
- [x] 修复产品添加页面"添加"按钮无反应的问题(FileUpload ID冲突)
- [x] 修复新闻添加页面富文本编辑器不显示的问题(更换为Tiptap)



## Bug修复 (2025-10-29 下午)
- [x] 修复图片上传失败的问题(认证问题已解决)
- [x] 修复产品创建SQL错误(更新API schema添加brand/price/downloads字段)
- [x] 修复shadcn Button组件点击无响应问题(替换为原生button元素)




## 补丁应用 (2025-10-29)
- [x] 应用local-storage-upload.patch补丁
  - 添加本地文件存储fallback机制
  - 当S3配置缺失时自动保存到服务器uploads目录
  - 添加/uploads静态文件服务




## 待处理 (2025-10-29 晚上)
- [x] 删除技术支持页面的"提交支持请求"表单部分


- [x] 删除技术支持页面的"在线咨询"支持服务选项



## 补丁应用 (2025-10-29 晚上)
- [x] 应用fix-json-product.patch补丁修复后台产品上传JSON字段问题



## 分支合并 (2025-10-29 晚上)
- [x] 合并codex/fix-news-and-product-addition-error分支到main
  - 添加自动slug生成功能
  - 改进产品和新闻创建逻辑
  - 允许在创建时设置发布状态



## 新闻功能Bug修复 (2025-10-29 晚上)
- [x] 修复首页新闻卡片不显示封面图片的问题
- [x] 创建新闻详情页面
- [x] 修复首页新闻点击跳转到详情页
- [x] 修复新闻编辑页面数据加载问题(重新打开时内容为空)




## Bug修复 (2025-10-29 晚上)
- [x] 修复新闻详情页标题被顶部导航栏遮挡的问题




## 新闻功能优化 (2025-10-29 晚上)
- [ ] 修复新闻封面图片上传后不显示的问题（需要用户测试确认）
- [ ] 修复编辑页面封面图片丢失的问题（需要用户测试确认）
- [x] 删除所有测试新闻数据
- [x] 确保首页新闻和“新闻动态”页面数据联动（使用同一数据源）



- [x] 修复从新闻动态页面点击进入详情页后页面滚动位置在底部的问题


- [x] 修复编辑新闻时封面图片不显示的问题


- [x] 删除新闻动态页面“所有新闻”标题


- [x] 修复产品添加失败的问题（order字段是MySQL保留关键字，需要反引号）




## Bug诊断 (2025-10-30)
- [x] 诊断产品创建"Unknown column 'downloads'"错误
  - 验证数据库表结构正确（downloads字段存在）
  - 验证SQL语句可以正常执行
  - 确认SQL语句和参数都正确
  - 发现SQL执行时抛出异常但未被捕获
  - 添加详细的错误捕获和日志
- [ ] 等待用户更新代码并查看详细错误信息





## 产品功能优化 (2025-10-30)
- [x] 修复产品创建"Unknown column 'downloads'"错误（数据库缺少字段）
- [x] 优化产品表单的分类选择，使用optgroup显示一级/二级分类层级结构




## 分类结构修正 (2025-10-30)
- [x] 将"海水淡化装置"改为一级分类
- [x] 将"油水分离器"改为一级分类
- [x] 合并"充电器"和"逆变器"为"充电器逆变器"一级分类
- [x] 修正parentId指向不存在父分类的二级分类（舱底泵、轴流式风机、挂机等）




## 品牌管理功能实现 (2025-10-30)
### 数据库层
- [x] 创建 brands 表（id, name, slug, logoUrl, website, order, isActive）
- [x] 修改 products 表，添加 brandId 外键字段
- [x] 添加"不便分类的产品"一级分类
- [x] 添加"无品牌"品牌记录

### 后台管理
- [x] 创建品牌管理页面（列表、新增、编辑、删除）
- [x] 修改产品表单，将品牌改为下拉选择（必填）
- [x] 更新后台菜单："产品分类" → "产品类别"，新增"品牌管理"

### 数据清理（后续手动）
- [ ] 在品牌管理中添加常用品牌
- [ ] 逐步删除分类中的品牌相关分类





## 品牌数据迁移和分类清理 (2025-10-30)
- [ ] 创建数据迁移脚本，将分类中的品牌自动迁移到brands表
- [ ] 删除分类中的所有品牌相关分类（36个）
- [ ] 确保所有现有产品都关联到正确的品牌





## 分类结构和品牌修复 (2025-10-30 下午)
- [x] 重新修正分类结构（海水淡化装置、油水分离器改为一级分类）
- [x] 重新合并“充电器”和“逆变器”为“充电器逆变器”
- [x] 修复产品表单：允许选择没有二级分类的一级分类
- [x] 清理品牌数据：只保留真正的品牌，删除产品分类





## 产品表单Bug修复 (2025-10-30 下午)
- [x] 修复产品图片显示重复的问题（删除ProductForm中的重复显示代码）
- [x] 修复资料下载上传逻辑（允许先上传文件再输入名称，或自动使用文件名）
- [x] 修复编辑产品时资料下载列表为空的问题（数据加载逻辑正确，数据库中本来就是空的）





## UI优化 (2025-10-30 下午)
- [x] 修复产品详情页面包屑导航被顶部导航栏遭挡的问题（将mt-20改为mt-32）
- [x] 将所有“商店”字样改为“产品”（面包屑导航、返回链接）




## 功能优化 (2025-10-30 下午)
- [x] 将产品展示页面的URL从 /shop 改为 /product（修改路由、导航栏、所有链接）
- [x] 修复首页产品类别“更多”按钮跳转后页面滚动位置（ProductShop页面添加useEffect滚动到顶部）
- [x] 修复首页新闻资讯“更多”按钮跳转后页面滚动位置（News页面添加useEffect滚动到顶部）
- [x] 实现搜索功能：创建搜索结果页面，支持搜索产品和新闻，带标签页切换



## Bug修复 (2025-10-30 晚上)
- [x] 修复App.tsx的import错误（AdminDashboard未定义）
- [x] 修复ProductShop.tsx缺少useEffect导入的错误
- [x] 修复SearchResults.tsx的URL参数解析问题（使用window.location.search）
- [x] 修复搜索结果页面URL参数变化时不更新的问题（使用useEffect监听location变化）



## 后台管理Bug修复 (2025-10-30 晚上)
- [x] 修复产品类别管理页面点击编辑出现404的问题（创建CategoryForm组件和路由）



## 后台管理功能增强 (2025-10-30 晚上)
- [x] 在CategoryForm中添加父分类选择功能，支持创建和编辑二级分类



## CategoryForm Bug修复 (2025-10-30 晚上)
- [x] 修复创建分类时的null值错误（将description、imageUrl、parentId的null改为undefined）



## 分类管理UI改进 (2025-10-30 晚上)
- [x] 将分类管理页面改为树状结构显示，父分类和子分类层级清晰，支持展开/收起



## 后台安全性增强 (2025-10-30 晚上)
- [x] 去掉登录页面的默认账号密码提示
- [x] 创建脚本生成随机强密码并保存到服务器文件（scripts/manage-admin-password.sh）
- [x] 提供查看密码的命令（只能通过SSH访问）
- [x] 编写详细的密码管理文档（ADMIN_PASSWORD.md）



## 密码认证系统改造 (2025-10-30 晚上)
- [x] 在users表schema中添加password字段
- [x] 运行数据库迁移添加password列（通过webdev_execute_sql执行ALTER TABLE）
- [x] 修改oauth.ts的登录逻辑，从数据库验证密码哈希（使用bcrypt.compare）
- [x] 为admin用户生成并设置密码哈希（密码：l0skFn5ALP）

